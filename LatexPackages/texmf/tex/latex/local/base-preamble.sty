% \ProvidePackage{preamble}[2020/10/07 1.0.0 General preamble]

\usepackage{amsmath, amsthm, amssymb, cases, mathtools, bm, nicefrac} % general math
\usepackage{stmaryrd}               % for \trianglelefteqslant and to create \xmapsfrom
\usepackage{array, multicol}
\usepackage{centernot}              % for \centernot
% \usepackage{faktor}                 % for \faktor
\usepackage[makeroom]{cancel}  
\usepackage{xparse}
\usepackage[shortlabels]{enumitem}
\usepackage{float}
\usepackage{letltxmacro}
\usepackage{geometry}
\usepackage{standalone}

\LetLtxMacro\amsproof\proof
\LetLtxMacro\amsendproof\endproof

\usepackage[style=arsclassica, pdfspacing, eulermath]{classicthesis}

\usepackage{thmtools, thm-restate}
\usepackage[framemethod=TikZ]{mdframed}
\usepackage{tikz-cd}
\usetikzlibrary{shapes}

\usepackage{hyperref} % must be second-to-last package
\usepackage{cleveref} % must be last package

\DeclareMathAlphabet{\mathcal}{OMS}{cmsy}{m}{n}

\restylefloat{table}

\renewcommand\large{\@setfontsize\large{11.5pt}{18}}


\@ifundefined{chapter}{
    % empty
    % article classes
}{
    \renewcommand\formatchapter[1]{% 
        \begin{minipage}[b]{0.15\linewidth}
        \chapterNumber
        \end{minipage}%
        \begin{minipage}[b]{0.6\linewidth}
        \raggedright\spacedallcaps{#1}
        \end{minipage}
    }
    \renewcommand*{\chapterformat}{%
        \mbox{\chapappifchapterprefix{\nobreakspace}%
        \scalebox{2}{\color{gray}\thechapter\autodot}\enskip}
    }
}

\renewenvironment{proof}[1][\proofname]
    {\par\pushQED{\qed}%
    \normalfont \topsep3\p@\@plus6\p@\relax
    \list{}{\leftmargin=1em
        \rightmargin=\leftmargin
        \settowidth{\itemindent}{\itshape#1}%
        \labelwidth=\itemindent
        % the following line is not needed with amsart, but might be with other classes
        \parsep=0pt \listparindent=\parindent 
    }
    \item[\hskip\labelsep
        %  \scshape
        \bfseries
        #1\@addpunct{.\hspace{1em}}]\ignorespaces}
    {\popQED\endlist\@endpefalse}

% <******************************************************> %
% <******************* THEOREM STYLES *******************> %
% <******************************************************> %

% <* thmstyle *> %
\declaretheoremstyle[
    spaceabove=2\topsep, spacebelow=2\topsep,
    headindent=0pt,
    headfont=\bfseries,
    notefont=\normalfont\normalsize\bfseries, notebraces={}{.},
    bodyfont=\itshape\normalsize,
    % headformat={\llap{\NAME \NUMBER} \NOTE},
    headformat={\llap{\smash{\parbox[t]{1.0in}{\centering \NAME\\ \NUMBER}}} \NOTE},
    headpunct={},
    % qed={$lrcorner$},
    postheadspace=10pt
]{thmstyle}
\declaretheorem[numberwithin=section, style=thmstyle]{principle}
\declaretheorem[name=Teorema, numberwithin=section, style=thmstyle]{theorem}
\declaretheorem[name=Assioma, sibling=theorem, style=thmstyle]{axiom}
\declaretheorem[name=Corollario, sibling=theorem, style=thmstyle]{corollary}
\declaretheorem[name=Proposizione, sibling=theorem, style=thmstyle]{proposition}
\declaretheorem[name=Lemma, sibling=theorem, style=thmstyle]{lemma}

% <* defstyle *> %
\declaretheoremstyle[
    spaceabove=2\topsep, spacebelow=2\topsep,
    headindent=0pt,
    headfont=\bfseries,
    notefont=\normalfont\normalsize\bfseries, notebraces={}{.},
    bodyfont=\normalfont\normalsize,
    headformat={\llap{\smash{\parbox[t]{1.1in}{\centering \NAME\\ \NUMBER}}} \NOTE},
    headpunct={},
    % qed={$\lrcorner$},
    postheadspace=10pt
]{defstyle}
\declaretheorem[name=Definizione, sibling=theorem, style=defstyle]{definition}

% <* exmplstyle *> %
\declaretheoremstyle[
    spaceabove=\topsep, spacebelow=\topsep,
    headfont=\bfseries,
    notefont=\small\normalfont\bfseries, notebraces={(}{)},
    bodyfont=\small\normalfont,
    % qed={$\lrcorner$},
    postheadspace=1em
]{exmplstyle}
\declaretheorem[name=Esempio, sibling=theorem, style=exmplstyle]{example}

% <* exercisestyle *> %
\declaretheoremstyle[
    spaceabove=2\topsep, spacebelow=2\topsep,
    headfont=\bfseries,
    notefont=\normalfont\normalsize\bfseries, notebraces={}{.},
    bodyfont=\normalfont\normalsize,
    headformat={\llap{\smash{\parbox[t]{1.1in}{\centering \NUMBER\ \NAME}}} \NOTE},
    headpunct={},
    % qed={$\lrcorner$},
    postheadspace=10pt
]{exercisestyle}
\declaretheorem[name=Esercizio, sibling=theorem, style=exercisestyle]{exercise}

% <* solutionstyle *> %
\declaretheoremstyle[
    spaceabove=2\topsep, spacebelow=2\topsep,
    headfont=\itshape,
    notefont=\normalfont\normalsize\bfseries, notebraces={}{.},
    bodyfont=\normalfont\normalsize,
    headformat={\llap{\smash{\parbox[t]{1.1in}{\centering \NAME}}} \NOTE},
    headpunct={},
    qed={$\lrcorner$},
    postheadspace=10pt
]{solutionstyle}
\declaretheorem[name=Soluzione, style=solutionstyle, numbered=no]{solution}
\declaretheorem[name=Intuizione, style=solutionstyle, numbered=no]{intuition}

% <* remarkstyle *> %
\declaretheoremstyle[
    spaceabove=\topsep, spacebelow=\topsep,
    headfont=\bfseries,
    notefont=\normalfont\normalsize\bfseries, notebraces={}{.},
    bodyfont=\normalfont\normalsize,
    postheadspace=1em
]{remarkstyle}
\declaretheorem[name=Osservazione, style=remarkstyle, numberwithin=section]{remark}

% <* notationstyle *> %
\declaretheoremstyle[
    spaceabove=\topsep, spacebelow=\topsep,
    headfont=\bfseries,
    notefont=\normalfont\normalsize\bfseries, notebraces={}{.},
    bodyfont=\normalfont\normalsize,
    postheadspace=1em
]{notationstyle}
\declaretheorem[name=Notazione, style=notationstyle, numbered=no]{notation}


% <******************************************************> %
% <****************** GENERAL COMMANDS ******************> %
% <******************************************************> %

% To work with systems of equations
\newcolumntype{z}{r<{{}}}
\newcolumntype{o}{@{}>{{}}c<{{}}@{}}

% Strong emphasis
\newcommand{\strong}[1]{\@strong{#1}}
\newcommand{\@@strong}[1]{\textbf{\let\@strong\@@@strong#1}}
\newcommand{\@@@strong}[1]{\textnormal{\let\@strong\@@strong#1}}
\let\@strong\@@strong

% <****** SET THEORY ******> $
\newcommand{\given}{}
\newcommand{\ColonGiven}{
    \nonscript\> : \allowbreak\nonscript\>\mathopen{}
} % ES: { x : x > 0 }

\newcommand{\StupidBarGiven}{
    \nonscript\; \vert  \allowbreak\nonscript\;\mathopen{}
}

\newcommand{\BarGiven}{
    \nonscript\; \delimsize\vert \allowbreak\nonscript\;\mathopen{}
    % \nonscript\; \delimsize\vert \allowbreak\nonscript\;\mathopen{}
} % ES: { x | x > 0 }

% To create a new set, just use $\set{x, y}$ or $\set{x \given x > 0}$
\DeclarePairedDelimiterX{\set}[1]{\{}{\}}{\,\Set@rgs{#1}\,}
\NewDocumentCommand{\Set@rgs}{>{\SplitArgument{1}{\given}}m}{\Set@rgs@ux#1}
\NewDocumentCommand{\Set@rgs@ux}{mm}{
    \IfNoValueTF{#2}{
        #1
    } {
        #1 \ColonGiven #2 % change to \BarGiven to get the bar
    }
}

% Other set-related symbols
\NewDocumentCommand{\card}{t+ s o m}{
    \IfBooleanTF{#1}
        {\#{#4}}
        {
            \IfBooleanTF{#2}
                {\abs*{#4}}
                {\abs[#3]{#4}}
        }
}
\newcommand{\union}{\cup}                       % set union
\newcommand{\inters}{\cap}                      % set intersection
\newcommand{\bigunion}{\bigcup}                 % big set union
\newcommand{\biginters}{\bigcap}                % big set union
\newcommand{\disjunion}{\sqcup}                 % disjoint union
\newcommand{\bigdisjunion}{\bigsqcup}           % big disjoint union
\newcommand{\compl}{^C}                         % set complement

% Intervals
\NewDocumentCommand{\interval}{ s m >{\SplitArgument{1}{,}}m m o }{
    \IfBooleanTF{#1}{
        \left#2 \IntervArgs #3 \right#4
    }{
        \IfValueTF{#5}{
            #5{#2} \IntervArgs #3 #5{#4}
        }{
            #2 \IntervArgs #3 #4
        }
    }
}
\NewDocumentCommand{\IntervArgs}{mm}{#1, \, #2}

% Greek letters
\renewcommand{\epsilon}{\varepsilon}
\newcommand{\eps}{\epsilon}
\renewcommand{\theta}{\vartheta}
\renewcommand{\rho}{\varrho}
\let\oldphi\phi
\renewcommand{\phi}{\varphi}
\newcommand{\eulerphi}{\oldphi}

% Useful general paired delimiters
\DeclarePairedDelimiter{\parens}{(}{)}
\DeclarePairedDelimiter{\squared}{[}{]}
\DeclarePairedDelimiter{\dbracket}{\llbracket}{\rrbracket}
\DeclarePairedDelimiter{\curly}{\{}{\}}
\DeclarePairedDelimiter{\abs}{\lvert}{\rvert}   % absolute value
\DeclarePairedDelimiter{\ang}{\langle}{\rangle} % angular parenthesis
\NewDocumentCommand{\norm}{sog}{                % norm (with automatic \cdot inside if empty)
    \IfValueTF{#3}{
        \IfBooleanTF{#1}{
            \norm@delim*{#3}
        }{
            \norm@delim[#2]{#3}
        }
    }{
        \norm@delim{\cdot}
    }
}
\DeclarePairedDelimiter{\norm@delim}{\lVert}{\rVert}


% Modified equals
\newcommand{\deq}{\coloneqq}
\newcommand{\iseq}{\overset{?}{=}}
\newcommand{\seteq}{\overset{!}{=}}

% General function stuff
 \newcommand{\xmapsfrom}[2][]{%
    \ext@arrow3095\leftarrowfill@{#1}{#2}\mapsfromchar
}
\newcommand{\inject}[2][]{\xhookrightarrow[#1]{#2}}
\newcommand{\biject}{\xleftrightarrow{}}
\newcommand{\isomorphTo}{\xrightarrow{\tilde}}
\DeclareMathOperator{\id}{id}               % identity function
\newcommand{\inv}{^{-1}}                    % inverse
\newcommand{\Imm}[1]{\operatorname{Im} #1}  % image of a function
\newcommand\restrict[1]                     % function restriction
    {\raisebox{-.5ex}{$|$}_{#1}}
\NewDocumentCommand{\sgn}{sog}{
    \operatorname{sgn}
    \IfValueT{#3}{
        \IfBooleanTF{#1}{
            \parens*{#3}
        } {
            \parens[#2]{#3}
        }
    }
}

% Complex numbers
\let\oldre\Re
\let\oldim\Im
\let\Re\relax
\let\Im\relax
\DeclarePairedDelimiterXPP{\Re}[1]              % real part
    {\operatorname{Re}}(){}{#1}
\DeclarePairedDelimiterXPP{\Im}[1]              % imaginary part
    {\operatorname{Im}}(){}{#1}
\newcommand{\conj}[1]{\overline{#1}}            % complex conjugate

% Modular arithmetic
\def\localbig#1#2{%
  \sbox\z@{$\m@th#1
    \sbox\tw@{$#1()$}%
    \dimen@=\ht\tw@\advance\dimen@\dp\tw@
    \nulldelimiterspace\z@\left#2\vcenter to1.2\dimen@{}\right.
  $}\box\z@}

\newcommand{\divides}{\mathrel{\mathpalette\dividesaux\relax}}
\newcommand{\ndivides}{\mathrel{\mathpalette\ndividesaux\relax}}

\newcommand{\dividesaux}[2]{\mbox{$\m@th#1\localbig{#1}|$}}
\newcommand{\ndividesaux}[2]{%
  \mkern.5mu
  \ooalign{%
    \hidewidth$\m@th#1\localbig{#1}|$\hidewidth\cr
    $\m@th#1\nmid$\cr%
  }%
}

\newcommand{\congr}{\equiv}                 % congruent 
\newcommand{\ncongr}{\not\congr}            % not congruent
\NewDocumentCommand{\Mod}{t+ som}{          % (mod m) with or without "mod"
    \;
    \IfBooleanTF{#1}{
        \IfBooleanTF{#2}{
            \parens*{\operatorname{mod} #4}
        }{
            \parens[#3]{\operatorname{mod} #4}
        }
    }{
        \IfBooleanTF{#2}{
            \parens*{#4}
        }{
            \parens[#3]{#4}
        }
    }
}     
\newcommand{\gcdname@}{\operatorname{gcd}}
\newcommand{\lcmname@}{\operatorname{lcm}}
\RenewDocumentCommand{\gcd}{t+ som}{        % gcd - greatest common divisor
    \IfBooleanT{#1}{
        \gcdname@
    }
    \IfBooleanTF{#2}{
        \parens*{#4}
    }{
        \IfNoValueTF{#3}{
            \parens{#4}
        }{
            \parens[#3]{#4}
        }
    }
}
\NewDocumentCommand{\lcm}{t+ som}{          % lcm - least common multiple
    \IfBooleanTF{#1}{
        \lcmname@
        \IfBooleanTF{#2}{
            \parens*{#4}
        }{
            \IfNoValueTF{#3}{
                \parens{#4}
            }{
                \parens[#3]{#4}
            }
        }
    }{
        \IfBooleanTF{#2}{
            \squared*{#4}
        }{
            \IfNoValueTF{#3}{
                \squared{#4}
            }{
                \squared[#3]{#4}
            }
        }
    }
}

\NewDocumentCommand{\eqcl}{t+ s o m e_}{
    \IfBooleanTF{#1}{
        \overline{#4}
    }{
        \IfBooleanTF{#2}{
            \squared*{#4}
        }{
            \IfNoValueTF{#3}{
                \squared{#4}
            }{
                \squared[#3]{#4}
            }
        }
        \IfValueT{#5}{
            _{#5}
        }
    }
}

\NewDocumentCommand{\seqn}{s o m e_}{
    \IfBooleanTF{#1}
        {\parens*{#3}}
        {\parens[#2]{#3}}
    \IfValueT{#4}
        {_{#4}}
}
% \NewDocumentCommand{\EvaluateAt}{t+ s o m}{
%     \IfBooleanTF{#1}{
%         \IfBooleanTF{#2}{
%             \@VertEvaluateAt*{#4}
%         }{
%             \@VertEvaluateAt[#3]{#4}
%         }{
%             \IfBooleanTF{#2}{
%                 \@SqEvaluateAt*{#4}
%             }{
%                 \@SqEvaluateAt[#3]{#4}
%             }
%         }
%     }
%     % \IfValueT{#5}{
%     %     _{#5}
%     % }
%     % \IfValueT{#6}{
%     %     ^{#6}
%     % }
% }
\newcommand{\EvaluateAt}{\@SqEvaluateAt}
\DeclarePairedDelimiter{\@SqEvaluateAt}[]
\DeclarePairedDelimiter{\@VertEvaluateAt}{.}{\rvert}

\renewcommand{\vec}[1]{\mathbold{#1}}                     % vector
\newcommand{\trans}{^T}                             % transposed
\newcommand{\ctrans}{^H}                            % complex transposed
\NewDocumentCommand{\Span}{t+ som}{                 % Span of vectors
    \operatorname{span}
    \IfBooleanTF{#1}{
        \IfBooleanTF{#2}{
            \set*{#4}
        }{
            \set[#3]{#4}
        }
    }{
        \IfBooleanTF{#2}{
            \parens*{#4}
        }{
            \parens[#3]{#4}
        }
    }
}

% Widebar
\DeclareFontFamily{U}{mathx}{\hyphenchar\font45}
\DeclareFontShape{U}{mathx}{m}{n}{<-> mathx10}{}
\DeclareSymbolFont{mathx}{U}{mathx}{m}{n}
\DeclareMathAccent{\widebar}{0}{mathx}{"73}
\renewcommand{\bar}[1]{\widebar{#1}}

\newcommand{\vecbar}[1]{\vec{\bar{#1}}}

% MATHBB LETTERS
\newcommand{\A}{\mathbb{A}}
\newcommand{\B}{\mathbb{B}}
\newcommand{\C}{\mathbb{C}}     % complex numbers
\newcommand{\D}{\mathbb{D}}
\newcommand{\E}{\mathbb{E}}
\newcommand{\F}{\mathbb{F}}     % general field
\newcommand{\G}{\mathbb{G}} 
\renewcommand{\H}{\mathbb{H}}   % quaternions
\newcommand{\I}{\mathbb{I}}
\newcommand{\J}{\mathbb{J}}
\newcommand{\K}{\mathbb{K}}     % general field
\renewcommand{\L}{\mathbb{L}}
\newcommand{\M}{\mathbb{M}}
\newcommand{\N}{\mathbb{N}}     % natural numbers
\renewcommand{\O}{\mathbb{O}}
\renewcommand{\P}{\mathbb{P}}
\newcommand{\Q}{\mathbb{Q}}     % rational numbers
\newcommand{\R}{\mathbb{R}}     % real numbers
\renewcommand{\S}{\mathbb{S}}
\newcommand{\T}{\mathbb{T}}
\newcommand{\U}{\mathbb{U}}
\newcommand{\V}{\mathbb{V}}
\newcommand{\W}{\mathbb{W}}
\newcommand{\X}{\mathbb{X}}
\newcommand{\Y}{\mathbb{Y}}
\newcommand{\Z}{\mathbb{Z}}     % integers
\newcommand{\Zmod}[1]{\quot{\Z}{#1\Z}} % integers mod #1

% MATHCAL LETTERS
\renewcommand{\AA}{\mathcal{A}}
\newcommand{\BB}{\mathcal{B}}
\newcommand{\CC}{\mathcal{C}}
\newcommand{\DD}{\mathcal{D}}
\newcommand{\EE}{\mathcal{E}}
\newcommand{\FF}{\mathcal{F}}
\newcommand{\GG}{\mathcal{G}} 
\newcommand{\HH}{\mathcal{H}}
\newcommand{\II}{\mathcal{I}}
\newcommand{\JJ}{\mathcal{J}}
\newcommand{\KK}{\mathcal{K}}
\newcommand{\LL}{\mathcal{L}}
\newcommand{\MM}{\mathcal{M}}
\newcommand{\NN}{\mathcal{N}}
\newcommand{\OO}{\mathcal{O}}
\newcommand{\PP}{\mathcal{P}}
\newcommand{\QQ}{\mathcal{Q}}
\newcommand{\RR}{\mathcal{R}}
\renewcommand{\SS}{\mathcal{S}}
\newcommand{\TT}{\mathcal{T}}
\newcommand{\UU}{\mathcal{U}}
\newcommand{\VV}{\mathcal{V}}
\newcommand{\WW}{\mathcal{W}}
\newcommand{\XX}{\mathcal{X}}
\newcommand{\YY}{\mathcal{Y}}
\newcommand{\ZZ}{\mathcal{Z}}

\endinput